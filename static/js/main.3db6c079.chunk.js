(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{132:function(t,e,a){"use strict";a.r(e);a(72),a(97);var n=a(0),s=a.n(n),i=a(42),r=a.n(i),c=a(29),o=a.n(c),l=a(22),u=a.n(l),d=a(30),h=a(10),m=a(11),b=a(14),p=a(12),f=a(13),v=a(1),y=(a(119),a(68)),S=a.n(y),g=a(6),k=a(31),w=a.n(k),x=a(69),E=a.n(x),j=a(32),B=a.n(j),C=a(45),O=a.n(C),_=function(t){function e(t){var a;return Object(h.a)(this,e),(a=Object(b.a)(this,Object(p.a)(e).call(this,t))).state={rights:t.rights,mode:t.mode,opened:!1},a.toggleContext=a.toggleContext.bind(Object(g.a)(Object(g.a)(a))),a}return Object(f.a)(e,t),Object(m.a)(e,[{key:"toggleContext",value:function(){this.setState({opened:!this.state.opened})}},{key:"render",value:function(){return"editor"===this.state.rights||"admin"===this.state.rights?s.a.createElement(v.PanelHeader,null,s.a.createElement(v.PanelHeaderContent,{aside:s.a.createElement(w.a,null),onClick:this.toggleContext},"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"),s.a.createElement(v.HeaderContext,{opened:this.state.opened,onClose:this.toggleContext},s.a.createElement(v.List,null,s.a.createElement(v.Cell,{before:s.a.createElement(E.a,null),asideContent:"subscribe"===this.state.mode?s.a.createElement(B.a,{fill:"var(--accent)"}):s.a.createElement("div",{style:{width:"24px"}}),"data-mode":"subscribe"},"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"),s.a.createElement(v.Cell,{before:s.a.createElement(O.a,null),asideContent:"statistic_full"===this.state.mode?s.a.createElement(B.a,{fill:"var(--accent)"}):s.a.createElement("div",{style:{width:"24px"}}),"data-mode":"statistic_full"},"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430"),s.a.createElement(v.Cell,{before:s.a.createElement(O.a,null),asideContent:"statistic_cur"===this.state.mode?s.a.createElement(B.a,{fill:"var(--accent)"}):s.a.createElement("div",{style:{width:"24px"}}),"data-mode":"statistic_cur"},"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0441\u0435\u0437\u043e\u043d")))):s.a.createElement(v.PanelHeader,null,"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f")}}]),e}(s.a.Component),I=a(24),T=a.n(I),R=a(43),N=a.n(R),W=a(44),P=a.n(W),L=function(t){function e(t){var a;return Object(h.a)(this,e),(a=Object(b.a)(this,Object(p.a)(e).call(this,t))).state={animeId:t.anime.anime_id,animeName:t.anime.anime_name,animeNameRus:t.anime.anime_name_rus,shikiId:t.anime.shiki_id,subStatus:t.anime.sub_status,dubStatus:t.anime.dub_status,shikiResp:void 0,opened:!1,showed:t.anime.showed,subSwitching:!1,dubSwitching:!1},a.click=a.click.bind(Object(g.a)(Object(g.a)(a))),a.clickButton=a.clickButton.bind(Object(g.a)(Object(g.a)(a))),a}return Object(f.a)(e,t),Object(m.a)(e,[{key:"click",value:function(t){this.setState({opened:!this.state.opened})}},{key:"clickButton",value:function(){var t=Object(d.a)(u.a.mark(function t(e,a){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.stopPropagation(),!(0===a&&-2!==this.state.subStatus&&-1!==this.state.subStatus||1===a&&-2!==this.state.dubStatus&&-1!==this.state.dubStatus)){t.next=20;break}t.t0=a,t.next=0===t.t0?5:1===t.t0?7:9;break;case 5:return this.setState({subSwitching:!0}),t.abrupt("break",9);case 7:return this.setState({dubSwitching:!0}),t.abrupt("break",9);case 9:return t.next=11,this.props.switch(this.state.animeId,a);case 11:if(0!==t.sent.error_code){t.next=20;break}t.t1=a,t.next=0===t.t1?16:1===t.t1?18:20;break;case 16:return 1!==this.state.subStatus&&0!==this.state.subStatus||this.setState({subStatus:1-this.state.subStatus,subSwitching:!1}),t.abrupt("break",20);case 18:return 1!==this.state.dubStatus&&0!==this.state.dubStatus||this.setState({dubStatus:1-this.state.dubStatus,dubSwitching:!1}),t.abrupt("break",20);case 20:case"end":return t.stop()}},t,this)}));return function(e,a){return t.apply(this,arguments)}}()},{key:"getButtonStyle",value:function(t,e){if(e)return"secondary";switch(t){case-1:return"secondary";case 0:return"primary";case 1:return"outline"}}},{key:"getBeforeSymbol",value:function(t,e){if(e)return s.a.createElement(v.Spinner,{size:"small"});switch(t){case 1:return s.a.createElement(T.a,null)}}},{key:"render",value:function(){var t=this;if(this.state.showed)return s.a.createElement("div",{style:{display:"flex",borderTop:"0px",borderBottom:"1px",borderRight:"0px",borderLeft:"0px",borderStyle:"solid",borderColor:"var(--button_bot_shadow)",marginBottom:"5px",paddingTop:"5px",paddingBottom:"5px",backgroundColor:"var(--background_content)",padding:"12px",color:"var(--accent)"},onClick:this.click},s.a.createElement("div",{style:{display:"flex",float:"left",alignItems:"center",justifyContent:"center",width:"25px",height:"32px"}},this.state.opened?s.a.createElement(N.a,{fill:"var(--accent)"}):s.a.createElement(P.a,{fill:"var(--accent)"})),s.a.createElement("div",{style:{display:"flex",justifyContent:"space-around",width:"100%"}},s.a.createElement("div",{style:{display:"flex",maxWidth:"590px",flexWrap:"wrap"}},s.a.createElement("div",{style:{display:"flex",height:"32px"}},s.a.createElement("div",{style:{display:"flex",float:"left",alignItems:"center",justifyContent:"left",marginLeft:"7px",width:"300px"}},this.state.animeName," / ",this.state.animeNameRus)),s.a.createElement("div",{style:{display:"flex",marginTop:"5px"}},s.a.createElement("div",{style:{display:"flex",width:"100%"}},s.a.createElement(v.Button,{stretched:!0,level:this.getButtonStyle(this.state.subStatus,this.state.subSwitching),before:this.getBeforeSymbol(this.state.subStatus,this.state.subSwitching),onClick:function(e){return t.clickButton(e,0)},style:{minWidth:"120px",marginRight:"6px"}},"\u0421\u0443\u0431\u0442\u0438\u0442\u0440\u044b"),s.a.createElement(v.Button,{stretched:!0,level:this.getButtonStyle(this.state.dubStatus,this.state.dubSwitching),before:this.getBeforeSymbol(this.state.dubStatus,this.state.dubSwitching),onClick:function(e){return t.clickButton(e,1)},style:{minWidth:"120px",marginLeft:"6px"}},"\u041e\u0437\u0432\u0443\u0447\u043a\u0430"))))))}}]),e}(s.a.Component),D=a(70),H=a.n(D),V=function(t){function e(t){var a;return Object(h.a)(this,e),(a=Object(b.a)(this,Object(p.a)(e).call(this,t))).state={animeId:t.anime.anime_id,animeName:t.anime.anime_name,animeNameRus:t.anime.anime_name_rus,shikiId:t.anime.shiki_id,subStatus:t.anime.sub_status,dubStatus:t.anime.dub_status,shikiResp:void 0,opened:!1,showed:t.anime.showed},a.click=a.click.bind(Object(g.a)(Object(g.a)(a))),a.clickButton=a.clickButton.bind(Object(g.a)(Object(g.a)(a))),a}return Object(f.a)(e,t),Object(m.a)(e,[{key:"click",value:function(t){this.setState({opened:!this.state.opened})}},{key:"clickButton",value:function(t,e){if(console.log(t),0===e&&-2!==this.state.subStatus&&-1!==this.state.subStatus||1===e&&-2!==this.state.dubStatus&&-1!==this.state.dubStatus)switch(e){case 0:this.setState({subStatus:-2});break;case 1:this.setState({dubStatus:-2})}}},{key:"getButtonStyle",value:function(t){switch(t){case-1:return"secondary";case 0:return"primary";case 1:return"outline";case-2:return"secondary"}}},{key:"getBeforeSymbol",value:function(t){switch(t){case 1:return s.a.createElement(T.a,null);case-2:return s.a.createElement(v.Spinner,{size:"small"})}}},{key:"render",value:function(){var t=this;if(this.state.showed)return s.a.createElement("div",{style:{display:"flex",fontSize:"13px",borderTop:"0px",borderBottom:"1px",borderRight:"0px",borderLeft:"0px",borderStyle:"solid",borderColor:"var(--button_bot_shadow)",marginBottom:"5px",paddingTop:"5px",paddingBottom:"5px",backgroundColor:"var(--background_content)",padding:"12px",color:"var(--accent)"},onClick:this.click},s.a.createElement("div",{style:{display:"flex",float:"left",alignItems:"center",justifyContent:"center",minWidth:"300"}},s.a.createElement("div",{style:{}},this.state.opened?s.a.createElement(w.a,{fill:"var(--accent)"}):s.a.createElement(H.a,{fill:"var(--accent)"}))),s.a.createElement("div",{style:{display:"flex",float:"left",marginLeft:"7px"}},this.state.animeName,s.a.createElement("br",null),this.state.animeNameRus),s.a.createElement("div",{style:{display:"flex",width:"auto"}},s.a.createElement(v.Button,{stretched:!0,level:this.getButtonStyle(this.state.subStatus),before:this.getBeforeSymbol(this.state.subStatus),onClick:function(e){return t.clickButton(e,0)},style:{minWidth:"120px"}},"\u0421\u0443\u0431\u0442\u0438\u0442\u0440\u044b"),s.a.createElement(v.Button,{stretched:!0,level:this.getButtonStyle(this.state.dubStatus),before:this.getBeforeSymbol(this.state.dubStatus),onClick:function(e){return t.clickButton(e,1)},style:{minWidth:"120px"}},"\u041e\u0437\u0432\u0443\u0447\u043a\u0430")))}}]),e}(s.a.Component),z=a(131).sprintf,A=function(t){function e(t){var a;Object(h.a)(this,e),a=Object(b.a)(this,Object(p.a)(e).call(this,t));var n=S.a.parse(window.location.search),s=new FormData;for(var i in n)s.append(i,n[i]);return a.state={mode:"subscribe",rights:n.vk_viewer_group_role,userId:n.vk_user_id,clientType:n.vk_platform,subscribeTitles:[],urlData:s},a}return Object(f.a)(e,t),Object(m.a)(e,[{key:"selectScreen",value:function(){}},{key:"componentDidMount",value:function(){var t=this;fetch(z("https://api.sovetromantica.com/api/v1/notify/vkapp/%s/get",this.state.userId),{method:"POST",body:this.state.urlData}).then(function(t){return t.json()}).then(function(e){for(var a in e)e[a].showed=!0;t.setState({subscribeTitles:e})})}},{key:"switchSubscribeStatus",value:function(){var t=Object(d.a)(u.a.mark(function t(e,a){var n,s;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0===e||void 0===e||void 0===a){t.next=10;break}return t.next=3,fetch(z("https://api.sovetromantica.com/api/v1/notify/vkapp/%s/switch/%s/%s",this.state.userId,e,a),{method:"POST",body:this.state.urlData});case 3:return n=t.sent,t.next=6,n.json();case 6:return s=t.sent,t.abrupt("return",s);case 10:console.log("switch parameters are wrong");case 11:case"end":return t.stop()}},t,this)}));return function(e,a){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return s.a.createElement(v.Root,{activeView:"sub-title"},s.a.createElement(v.View,{id:"sub-title",activePanel:this.state.mode},s.a.createElement(v.Panel,{id:"subscribe"},s.a.createElement(_,{rights:this.state.rights,mode:this.state.mode}),s.a.createElement(v.Search,null),this.state.subscribeTitles.map(function(e){return"desktop_web"!==t.state.clientType?s.a.createElement(V,{anime:e,switch:t.switchSubscribeStatus}):s.a.createElement(L,{anime:e,switch:t.switchSubscribeStatus.bind(t)})}))))}}]),e}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.subscribe(function(t){switch(t.detail.type){case"VKWebAppUpdateConfig":var e=document.createAttribute("scheme");e.value=t.detail.data.scheme?t.detail.data.scheme:"client_light",document.body.attributes.setNamedItem(e);break;default:console.log(t.detail.type)}}),o.a.send("VKWebAppInit",{}),r.a.render(s.a.createElement(A,null),document.getElementById("root"))},71:function(t,e,a){t.exports=a(132)}},[[71,1,2]]]);
//# sourceMappingURL=main.3db6c079.chunk.js.map